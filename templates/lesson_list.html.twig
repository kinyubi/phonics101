{% extends 'base.html.twig' %}
{#
Build a page of available lessons.
used by: ReadXYZ\Twig\LessonListTemplate

inherited inputs:
    pageTitle       : (from Page instance)
    menu            : key value pairs of title => link for navbar (from Page instance)
inputs:
    accordion[]     : $accordion[$groupCode]['groupName' => groupName, 'lessons' => [lessonId]['lessonName' => x, 'mastery' => y]
    studentName     : obtained by calling Session::getStudentName()
    mostRecentLessonCode: lessonName of lesson most recently worked on
    mostRecentLessonName:
    groupInfo       : Info based on vw_group_with_keychain view
    lessonName      : associative array: lessonName => displayAs
    isLocal         : obtained by Util::isLocal()
#}

{# inherited blocks: title, modals, navBar, tabBar, body, otherJS #}

{% block title %}ReadXYZ Lessons{% endblock title %}

{% block body %}
	{% set iconList = ['no-mastery', 'advancing', 'mastered'] %}
	{% set iconTip = ['Unmastered', 'Advancing', 'Mastered!'] %}
	<style>
      a span {
          font-stretch: 100%;
          color: black;
          font: bold 20px Muli, Century Gothic, sans-serif;
      }
	</style>

	<div class="row d-flex bg-white justify-content-start mx-2 flex-wrap">

	{# DISPLAY MOST RECENT LESSON IF IT'S IN THE COOKIE #}
	{# {% if mostRecentLessonCode %}
		<div id="lesson-accordion" class="col-md-12 col-sm-12 col-lg-5 lesson-list--width">
		<div id="most-recent" class="card bg-readlite">
			<div class="card-header">
				<div class="row d-flex flex-nowrap just align-items-center ">
					{% set href = '/handler/lesson/' ~ mostRecentLessonCode %}
					<a href="{{ href }}" id="most-recent-lesson" class="row d-flex justify-content-between align-items-baseline flex-nowrap">
						<i class="fa fa-bolt text-warning fa-2x mx-3" aria-hidden="true"></i>
						<div class="h3 text-dark mx-4">{{ mostRecentLessonName|escape('html') }}</div>
						<div class="text-secondary h5">(most recent lesson)</div>
					</a>
				</div>
			</div>
		</div>
		</div>
	{% endif %} #}
	</div>
	<div class="row d-flex bg-white justify-content-start mx-2 flex-wrap lesson-list-container">
	{# FOR EACH GROUP #}
	<div id="lesson-accordion" class="col-md-12 col-sm-12 col-lg-5 lesson-list--width lesson-list">
		<div class="container">
			<div class="row lesson-progress">
				<div class="col-4">
					<div> {{lessonsCompleted}} of {{lessonsTotal}} Lessons Completed</div>
				</div>
				<div class="col-4">
					<div class="progress lesson-progress-bar">
						<div class="progress-bar progress-bar-completed" role="progressbar" style="width: {{lessonsProgress}}%" aria-valuemin="0" aria-valuemax="100"></div>
					</div>
				</div>
				<div class="col-4">
                    {% if mostRecentLessonCode %}
                        {% set href = '/handler/lesson/' ~ mostRecentLessonCode %}
    					<div class="row">
    						<div class="col-7"> <div>Most Recent:</div><div>Unit {{mostRecentLessonUnit}}: {{ mostRecentLessonName }}</div></div>
                            <a href="{{ href }}">
			                    <div class="col-5 progress-arrow-right" style="cursor: pointer;" ></div>
                            </a>
    					</div>
                    {% endif %}
				</div>
			</div>
		</div>

        <ul class="lesson-list-ul">
    		{% for groupCode, groupInfo in accordion %}
    			{% set groupName = groupInfo.groupName %}
    			{% set groupIndex = loop.index %}
    			{% set groupHeader = 'header-' ~ loop.index %}
    			{% set groupCollapse = 'collapse-' ~ loop.index %}
    			{% set groupAnimal = keychainAnimals[groupCode].fileName %}
				{% set masteryIndex = lessonMasteries[loop.index - 1] %}
                <li class="lesson-list-li">
        			<div class="card bg-white border-readxyz lesson-list-card">
        				<div class="card-header bg-white" id="{{ groupHeader }}">
        					<a class="card-link" data-toggle="collapse" data-target="#{{ groupCollapse }}"
        					   aria-controls="{{ groupCollapse }}" aria-expanded="false" style="cursor: pointer">
        						<div class="row d-flex flex-nowrap align-items-center">
                                    <div class="col-2 accordion--image lesson-list-animal-image" style="background-image: url({{ groupAnimal }})"></div>
        							<div class="col-6 ml-3 text-dark button-text lesson-list-button-text">Unit {{groupIndex}}: {{ groupName }}</div>
									{% if masteryIndex == 0 %}
										<div class="col-4">
											<div class="progress lesson-progress-bar">
												<div class="progress-bar progress-bar-completed" role="progressbar" style="width: {{lessonMasteriesCount[loop.index - 1]}}%" aria-valuemin="0" aria-valuemax="100"></div>
											</div>
										</div>
									{% else %}
										<div class="col-4">
											<div class="row">
												<span style="font-size: 18px; font-weight: unset;">
													{{ iconTip[masteryIndex] }}
												</span>
												<div data-toggle="tooltip" title="{{ iconTip[masteryIndex] }}"
													class="col-4 mastery-group-icon mastery--{{ iconList[masteryIndex] }}">
												</div>
											</div>
										</div>
									{% endif %}
								</div>
        					</a>
        				</div>
        				<div id="{{ groupCollapse }}" class="collapse lesson-group-items" data-parent="#lesson-accordion"
        				     aria-labelledby="{{ groupHeader }}">
							<div class="card-header lesson-header-label">Lessons:</div>
        					<div class="card-body card-group-body">
        						<div class="bg-white">
        							<ul class="d-flex flex-column flex-nowrap pl-4" style="width:100%; ">

        								{# FOR EACH LESSON IN A GROUP #}
        								{% for lessonId, lessonInfo in groupInfo.lessons %}
        									{% set lessonName = lessonInfo.lessonName %}
        									{% set mastery = lessonInfo.mastery %}
        									{% set href = '/handler/lesson/' ~ lessonId|url_encode %}
        									<div class="list-group-item list-group-item-white list-group-item-lesson">
        										<div class="row d-flex flex-nowrap" style="height: 2em; position: relative;">
        											<div class="col-9">
														<a role="button" href="{{ href }}" class="text-dark ml-3 item-lesson-button">{{ lessonName }}</a>
													</div>

													<div class="col-3 list-group-icon">
													    {% if mastery == 0 %}
															<div class="progress lesson-progress-bar">
																<div class="progress-bar progress-bar-completed" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
															</div>
														{% else %}
															<div data-toggle="tooltip" title="{{ iconTip[mastery] }}"
															class="col-1 h-75 align-self-center mastery--image mastery--{{ iconList[mastery] }} mastery-icon"></div>
														{% endif %}
													</div>
        										</div>
        									</div>
        								{% endfor %}
        							</ul>
        						</div>
        					</div>
        				</div>
        			</div>
                </li>
    		{% endfor %}
        </ul>
	</div>

	</div>
{% endblock body %}


{% block otherJS %}
	<script>
		$(document).ready(function () {
			let leftBound = document.getElementById("lesson-accordion").getBoundingClientRect();
			let rightBound = document.getElementById("next-animal") .getBoundingClientRect();
			$('.card').css("min-width", (rightBound.right - leftBound.left -25).toString() + "px");
		});
	</script>
{% endblock %}
